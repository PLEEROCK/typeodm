import {defaultMetadataStorage} from "../metadata-builder/MetadataStorage";
import {WrongAnnotationUsageException} from "./exception/WrongAnnotationUsageException";
import {FieldTypeInFunction} from "../metadata-builder/metadata/FieldMetadata";
import {FieldTypes} from "../metadata-builder/FieldTypes";
import {WrongFieldTypeException} from "./exception/WrongFieldTypeException";

/**
 * Same as Field annotation, but used to mark a class properties that contain array data.
 */
export function ArrayField(typeFunction: FieldTypeInFunction): Function;
export function ArrayField(name: string, typeFunction: FieldTypeInFunction): Function;
export function ArrayField(name: string|FieldTypeInFunction, typeFunction?: FieldTypeInFunction): Function {
    return function (object: Object, propertyName: string) {
        if (name instanceof Function) {
            typeFunction = <FieldTypeInFunction> name;
            name = null;
        }

        if (!object || !propertyName || !object.constructor)
            throw new WrongAnnotationUsageException('ArrayField', 'class property', object);

        if (!FieldTypes.validateTypeInFunction(typeFunction))
            throw new WrongFieldTypeException(typeFunction, object.constructor.name, propertyName);

        defaultMetadataStorage.addFieldMetadata({
            object: object,
            name: name ? <string> name : undefined,
            type: typeFunction,
            isId: false,
            isAutoGenerated: false,
            isCreateDate: false,
            isUpdateDate: false,
            isArray: true,
            propertyName: propertyName
        });
    };
}